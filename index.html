<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Ultimate Neon Galaxy</title>

<style>
html,body{
  margin:0;padding:0;overflow:hidden;
  background:#02030a;
  font-family:monospace;
  touch-action:none;
}
#ui{
  position:fixed;bottom:15px;left:15px;
  color:#00ffee;background:rgba(0,0,0,.55);
  padding:12px 14px;border-radius:10px;
  font-size:14px;z-index:10;
}
#top{
  position:fixed;top:10px;left:50%;
  transform:translateX(-50%);
  color:#0ff;font-size:13px;opacity:.9;
}
#score{
  position:fixed;top:10px;right:15px;
  color:#fff;font-size:14px;
}
#joy{
  position:fixed;bottom:30px;right:30px;
  width:120px;height:120px;border-radius:50%;
  border:2px solid rgba(0,255,255,.3);
}
#stick{
  position:absolute;left:40px;top:40px;
  width:40px;height:40px;border-radius:50%;
  background:#0ff;opacity:.85;
}
</style>
</head>

<body>

<div id="top">üåå Mode: Galaxy</div>
<div id="score">Score: 0</div>

<div id="ui">
üéÆ Joystick = Move<br>
üëÜ Tap = Explosion<br>
üëÜüëÜ Double Tap = Mode<br>
‚òÑÔ∏è Long Hold = Meteor Rain<br>
üåÄ Mode = Vortex<br>
üåà 3 Fingers = RGB Toggle
</div>

<div id="joy"><div id="stick"></div></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
/* ===== CONFIG ===== */
const COUNT=900;
const MODES=["Galaxy","BlackHole","Warp","Vortex"];
let modeIndex=0;
let control={x:0,y:0};
let rgb=true;
let score=0;

/* ===== THREE ===== */
const scene=new THREE.Scene();
scene.fog=new THREE.FogExp2(0x02030a,0.05);

const camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,0.1,400);
camera.position.z=30;

const renderer=new THREE.WebGLRenderer({antialias:false});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(1.2);
document.body.appendChild(renderer.domElement);

/* ===== PARTICLES ===== */
const geo=new THREE.BufferGeometry();
const pos=new Float32Array(COUNT*3);
const vel=new Float32Array(COUNT*3);
const col=new Float32Array(COUNT*3);

for(let i=0;i<COUNT;i++){
  pos[i*3]=(Math.random()-.5)*60;
  pos[i*3+1]=(Math.random()-.5)*60;
  pos[i*3+2]=(Math.random()-.5)*60;
}

geo.setAttribute("position",new THREE.BufferAttribute(pos,3));
geo.setAttribute("color",new THREE.BufferAttribute(col,3));

const mat=new THREE.PointsMaterial({
  size:0.22,
  vertexColors:true,
  transparent:true,
  blending:THREE.AdditiveBlending,
  depthWrite:false
});

scene.add(new THREE.Points(geo,mat));

/* ===== UI ===== */
function setMode(){
  document.getElementById("top").textContent="üåå Mode: "+MODES[modeIndex];
}
setMode();

/* ===== JOYSTICK ===== */
const joy=document.getElementById("joy");
const stick=document.getElementById("stick");
let drag=false;

joy.addEventListener("touchstart",()=>drag=true);
addEventListener("touchend",()=>{
  drag=false;control.x=control.y=0;
  stick.style.left="40px";stick.style.top="40px";
});

joy.addEventListener("touchmove",e=>{
  if(!drag) return;
  const r=joy.getBoundingClientRect();
  const t=e.touches[0];
  let x=t.clientX-r.left-60;
  let y=t.clientY-r.top-60;
  x=Math.max(-40,Math.min(40,x));
  y=Math.max(-40,Math.min(40,y));
  stick.style.left=(x+40)+"px";
  stick.style.top=(y+40)+"px";
  control.x=x*0.4;
  control.y=-y*0.4;
},{passive:false});

/* ===== TOUCH ===== */
let lastTap=0;
let hold=false;

addEventListener("touchstart",e=>{
  const now=Date.now();
  if(e.touches.length===3) rgb=!rgb;

  if(now-lastTap<300){
    modeIndex=(modeIndex+1)%MODES.length;
    setMode();
  }
  lastTap=now;
  hold=true;
});

addEventListener("touchend",()=>hold=false);

/* ===== EFFECTS ===== */
function explosion(){
  for(let i=0;i<COUNT;i++){
    vel[i*3]=(Math.random()-.5)*6;
    vel[i*3+1]=(Math.random()-.5)*6;
    vel[i*3+2]=(Math.random()-.5)*6;
  }
  score+=10;
}

document.body.addEventListener("click",explosion);

/* ===== ANIMATE ===== */
let t=0;
function animate(){
  requestAnimationFrame(animate);
  t+=0.01;

  for(let i=0;i<COUNT;i++){
    const k=i*3;

    if(MODES[modeIndex]==="Galaxy"){
      pos[k]+= (control.x-pos[k])*0.02;
      pos[k+1]+= (control.y-pos[k+1])*0.02;
    }

    if(MODES[modeIndex]==="BlackHole"){
      pos[k]*=0.97;pos[k+1]*=0.97;pos[k+2]*=0.97;
    }

    if(MODES[modeIndex]==="Warp"){
      pos[k+2]-=1.5;
      if(pos[k+2]<-60) pos[k+2]=60;
    }

    if(MODES[modeIndex]==="Vortex"){
      const a=Math.atan2(pos[k+1],pos[k])+0.05;
      const r=Math.hypot(pos[k],pos[k+1]);
      pos[k]=Math.cos(a)*r;
      pos[k+1]=Math.sin(a)*r;
    }

    if(hold){
      vel[k+1]-=0.3; // meteor rain
    }

    pos[k]+=vel[k]||0;
    pos[k+1]+=vel[k+1]||0;
    pos[k+2]+=vel[k+2]||0;

    vel[k]*=0.9;vel[k+1]*=0.9;vel[k+2]*=0.9;

    if(rgb){
      col[k]=Math.sin(t+i*0.02)*0.5+0.5;
      col[k+1]=Math.sin(t+i*0.015+2)*0.5+0.5;
      col[k+2]=1;
    }else{
      col[k]=0;col[k+1]=1;col[k+2]=1;
    }
  }

  geo.attributes.position.needsUpdate=true;
  geo.attributes.color.needsUpdate=true;
  renderer.render(scene,camera);
  document.getElementById("score").textContent="Score: "+score;
}
animate();

addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>

</body>
</html>
