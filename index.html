<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gesture Particles Debug</title>

<style>
html,body{
  margin:0;
  padding:0;
  background:#000;
  overflow:hidden;
}
#ui{
  position:fixed;
  bottom:10px;
  left:10px;
  color:#0ff;
  font-family:monospace;
  z-index:10;
}
#tap{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#000;
  color:#0ff;
  font-size:20px;
  z-index:20;
}
#cam{
  position:fixed;
  top:10px;
  right:10px;
  width:120px;
  border:2px solid #0ff;
  z-index:15;
}
#dot{
  position:fixed;
  width:12px;
  height:12px;
  background:red;
  border-radius:50%;
  pointer-events:none;
  z-index:30;
}
</style>
</head>

<body>

<div id="tap">ðŸ‘† TAP TO START CAMERA</div>
<div id="ui">Waiting for handâ€¦</div>
<div id="dot"></div>

<video id="cam" autoplay muted playsinline></video>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/hands.js"></script>

<script>
/* ================= THREE ================= */
const scene=new THREE.Scene();
const camera3d=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,0.1,200);
camera3d.position.z=25;

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

const geo=new THREE.BufferGeometry();
const COUNT=600;
const pos=new Float32Array(COUNT*3);
const target=new Float32Array(COUNT*3);

for(let i=0;i<COUNT;i++){
  pos[i*3]=(Math.random()-.5)*20;
  pos[i*3+1]=(Math.random()-.5)*20;
  pos[i*3+2]=(Math.random()-.5)*20;
}

geo.setAttribute("position",new THREE.BufferAttribute(pos,3));

const points=new THREE.Points(
  geo,
  new THREE.PointsMaterial({color:0x00ffff,size:0.2})
);
scene.add(points);

/* ================= HANDS ================= */
const video=document.getElementById("cam");
const dot=document.getElementById("dot");
const ui=document.getElementById("ui");

const hands=new Hands({
  locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/${f}`
});

hands.setOptions({
  maxNumHands:1,
  modelComplexity:0,
  minDetectionConfidence:0.7,
  minTrackingConfidence:0.7
});

let hx=0,hy=0;

hands.onResults(res=>{
  if(!res.multiHandLandmarks) return;

  const lm=res.multiHandLandmarks[0][8]; // index finger
  hx=(lm.x-0.5)*30;
  hy=-(lm.y-0.5)*20;

  // visual proof
  dot.style.left=(lm.x*innerWidth-6)+"px";
  dot.style.top=(lm.y*innerHeight-6)+"px";

  ui.textContent="HAND DETECTED";
});

/* ================= START CAMERA ================= */
let started=false;
function start(){
  if(started) return;
  started=true;
  document.getElementById("tap").style.display="none";

  new Camera(video,{
    width:320,
    height:240,
    facingMode:"user",
    onFrame:async()=>await hands.send({image:video})
  }).start();
}

document.body.addEventListener("click",start);
document.body.addEventListener("touchstart",start);

/* ================= ANIMATE ================= */
function animate(){
  requestAnimationFrame(animate);
  const p=geo.attributes.position.array;
  for(let i=0;i<COUNT;i++){
    const k=i*3;
    p[k]+= (hx-p[k])*0.02;
    p[k+1]+= (hy-p[k+1])*0.02;
  }
  geo.attributes.position.needsUpdate=true;
  renderer.render(scene,camera3d);
}
animate();
</script>
</body>
</html>
